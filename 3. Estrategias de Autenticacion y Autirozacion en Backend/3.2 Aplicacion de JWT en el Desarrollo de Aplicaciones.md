# Aplicación de JWT en el Desarrollo de Aplicaciones

## Introducción a JWT (JSON Web Tokens)

**JWT (JSON Web Tokens)** es un estándar abierto ([RFC 7519](https://datatracker.ietf.org/doc/html/rfc7519)) que se utiliza para compartir información de manera segura y compacta entre dos partes: un cliente (como un navegador o aplicación móvil) y un servidor. JWT se ha convertido en un método popular para la autenticación sin estado en aplicaciones web modernas debido a su capacidad de gestionar la autenticación de manera eficiente y segura.

---

## ¿Cómo Funcionan los JWT?

Un JWT es esencialmente un token autodescriptivo y firmado digitalmente que contiene información sobre la identidad del usuario y cualquier otro dato relevante que el servidor desee incluir. Los JWT constan de tres partes:

1. **Header (Encabezado):**  
   Define el tipo de token y el algoritmo de cifrado utilizado (por ejemplo, HMAC, SHA256 o RSA).

2. **Payload (Carga Útil):**  
   Contiene los datos o _claims_ del usuario. Puede incluir información como el ID del usuario, roles y cualquier otro dato que se quiera transmitir.

3. **Signature (Firma):**  
   Se crea firmando el encabezado y la carga útil con una clave secreta o un par de claves privadas/públicas (dependiendo del algoritmo). Esto asegura la integridad del token, permitiendo al servidor verificar que no ha sido alterado.

Un JWT típico tiene un formato similar a esto:

```
xxxxx.yyyyy.zzzzz
```

Donde cada sección es un string codificado en Base64URL.

---

## Aplicación de JWT en la Autenticación Sin Estado

Los JWT son ideales para la autenticación sin estado porque el servidor no necesita almacenar sesiones en la memoria o en una base de datos. En cambio, el cliente guarda el token y lo envía con cada solicitud, lo que permite al servidor verificar la autenticidad del usuario sin necesidad de mantener el estado.

### Proceso de Autenticación

1. El usuario envía sus credenciales (como usuario y contraseña) al servidor.
2. Si las credenciales son válidas, el servidor genera un JWT que contiene la información del usuario.
3. El cliente almacena el JWT, generalmente en la memoria o en el _local storage_ del navegador.
4. Para acceder a rutas protegidas, el cliente envía el JWT en los headers de las solicitudes, típicamente en el campo `Authorization: Bearer <token>`.
5. El servidor valida el token y permite o deniega el acceso en función de la información contenida en el JWT.

---

## Configuración del Servidor con Express y JWT

A continuación, se detallan los pasos para configurar un servidor Express utilizando JWT para la autenticación, incluyendo la creación de rutas protegidas y la gestión de tokens.

### 1. Instalación de Dependencias

Para trabajar con JWT en Express, es necesario instalar las siguientes dependencias:

- `express`: Framework web para Node.js.
- `jsonwebtoken`: Librería para crear y verificar JWT.
- `bcrypt`: Para cifrar contraseñas de usuarios de manera segura (opcional).

Instala estas librerías usando:

```bash
npm install express jsonwebtoken bcrypt
```

---

### 2. Configuración del Servidor y Creación de Rutas

La configuración básica incluye la creación de rutas para registrar usuarios, iniciar sesión y proteger rutas mediante el uso de JWT.

#### Configuración de Rutas

- **Ruta de Registro:** Permite crear nuevos usuarios, cifrando la contraseña antes de almacenarla.
- **Ruta de Login:** Verifica las credenciales del usuario y genera un JWT si son correctas.
- **Ruta Protegida:** Ruta que solo puede ser accedida por usuarios autenticados con un JWT válido.

#### Ejemplo de Flujo

**Registro de Usuario:**

1. El usuario envía sus datos al servidor.
2. La contraseña se cifra y los datos se almacenan en la base de datos.

**Login del Usuario:**

1. El usuario envía sus credenciales.
2. El servidor verifica las credenciales y, si son correctas, genera un JWT y lo envía al cliente.

**Protección de Rutas con JWT:**

- Para proteger una ruta, se usa un _middleware_ que verifica si el JWT enviado por el cliente es válido.
- Si el token es válido, el middleware permite el acceso a la ruta protegida.

---

### 3. Gestión de Tokens y Protección de Solicitudes

Para proteger las solicitudes de los usuarios y asegurarse de que solo los usuarios autenticados puedan acceder a ciertas rutas, es necesario gestionar los tokens correctamente.

#### Implementación del Middleware de Verificación

- **Definición del Middleware:** Se verifica la existencia y validez del JWT en los headers de la solicitud.
- **Respuesta del Middleware:** Si el token es válido, se permite el acceso a la siguiente función o ruta; si no, se responde con un error.

**Pasos para Implementar el Middleware de Verificación de JWT:**

1. Extrae el token del header `Authorization`.
2. Verifica la validez del token utilizando la clave secreta configurada en el servidor.
3. Si el token es válido, se pasa la solicitud al siguiente middleware o ruta.
4. Si no es válido, se devuelve un error indicando que la autenticación ha fallado.

---

## Conclusión

JWT ofrece una forma robusta y escalable para gestionar la autenticación sin estado en aplicaciones web modernas. Su implementación con Express permite proteger rutas sensibles y mantener la seguridad de las solicitudes del usuario sin la necesidad de gestionar sesiones en el servidor. La correcta configuración de rutas y el uso de middleware de verificación garantizan que solo los usuarios autenticados puedan acceder a los recursos, manteniendo la integridad y seguridad de la aplicación.
