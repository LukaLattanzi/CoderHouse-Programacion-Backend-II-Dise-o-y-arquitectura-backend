# Configuración Avanzada de Routers y Variables de Entorno

## Ruteo Avanzado, Creación de Routers Personalizados y Manejo de Políticas

En esta sección aprenderás a utilizar estrategias avanzadas de ruteo en Express y a crear routers personalizados. También se aborda la gestión de middlewares, respuestas estandarizadas y el manejo de políticas de autorización con JWT.

---

### 1. Estrategias Avanzadas de Ruteo en Express

Express permite organizar y modularizar el ruteo de una aplicación mediante la creación de **routers personalizados**, lo que facilita el manejo de rutas complejas y la integración de middlewares específicos para grupos de rutas.

- **Routers Personalizados:** Permiten encapsular rutas y middlewares específicos, mejorando la organización y escalabilidad del código.
- **Gestión de Middlewares:** Los middlewares pueden añadirse a nivel de router, aplicándose solo a las rutas definidas dentro de ese router. Esto permite aplicar validaciones, manejo de errores y autenticación de manera más eficiente y modular.
- **Respuestas Estandarizadas:** Se pueden crear métodos personalizados en el objeto `res` (por ejemplo, `res.sendSuccess()`, `res.sendError()`) para un manejo consistente de las respuestas, facilitando la comunicación con el frontend.

---

### 2. Manejo de Políticas de Autorización con JWT

La autorización es clave para controlar el acceso a diferentes rutas dentro de una aplicación. Usar **JWT (JSON Web Tokens)** permite asignar roles y validar permisos a nivel de rutas.

#### Roles y Niveles de Acceso

- **PUBLIC:** Acceso libre, sin necesidad de autenticación.
- **AUTHENTICATED:** Requiere un token válido, aplicable a usuarios registrados.
- **USER:** Acceso exclusivo para usuarios estándar.
- **USER_PREMIUM:** Acceso para usuarios con membresía premium.
- **ADMIN:** Acceso reservado para administradores del sistema.

#### Middleware de Autorización

El middleware `handlePolicies` procesa el token JWT y verifica el rol del usuario contra un conjunto de políticas definidas para cada ruta. Esto permite establecer rutas públicas, privadas o restringidas a roles específicos.

---

### 3. Implementación Práctica

Para implementar estas estrategias, sigue estos pasos:

#### Crear un Router Personalizado

1. Define una clase que extienda de `Router` de Express.
2. Añade métodos personalizados para middlewares y respuestas.

#### Aplicar Políticas de Autorización

1. Define un middleware `handlePolicies` que reciba las políticas requeridas para cada ruta.
2. Verifica el rol del usuario extraído del token JWT contra las políticas permitidas.

#### Ejemplo de Uso

```js
const express = require("express");
const { handlePolicies } = require("./middlewares/auth");
const router = express.Router();

router.get("/admin", handlePolicies(["ADMIN"]), (req, res) => {
  res.sendSuccess("Welcome Admin");
});

module.exports = router;
```

---

Estas técnicas avanzadas permiten gestionar de manera efectiva el ruteo y la seguridad en aplicaciones backend complejas, asegurando un código más limpio, seguro y fácil de mantener.
